<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<title>日本の季節性インフルエンザの患者報告数</title>
</head><body>

<h1>日本の季節性インフルエンザの患者報告数</h1>
<canvas id="chart"></canvas>
DATA: オープンデータ <a href=https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/kenkou_iryou/kenkou/kekkaku-kansenshou01/houdou.html>インフルエンザに関する報道発表資料 ｜厚生労働省</a><br>
APP: <a href=https://fukuno.jig.jp/3425>Code for FUKUI</a> <a href=https://github.com/code4fukui/influenza/>src on GitHub</a><br>

<style>
body {
  text-align: center;
}
</style>

<script type="module">
import { CSV } from "https://js.sabae.cc/CSV.js";
//import { CBOR } from "https://js.sabae.cc/CBOR.js";
import { fetchBin } from "https://js.sabae.cc/fetchBin.js";
import Chart from "https://js.sabae.cc/Chart.mjs";

onload = async () => {
  //const data = await CBOR.decode(await fetchBin("https://code4fukui.github.io/influenza/influenza_mhlw_go_jp.csv.cbor"));
  const data = await CSV.fetch("https://code4fukui.github.io/influenza/influenza_mhlw_go_jp.csv");
  console.log(data);

  const date = [];
  const datasets = [];
  const hue = 300;
  const dset = {
    //label: data[0][j],
    type: "line",
    data: [],
    fill: false,
    lineTension: 0,
    yAxisID: "yr",
    borderColor: `hsl(${hue}, ${90}%, 40%)`,
  };
  datasets.push(dset);

  for (let j = 1; j < data[0].length; j++) {
    const year = data[0][j];
    for (let i = 1; i < data.length; i++) {
      const d = data[i];
      date.push(year + " " + d[0]);
      dset.data.push(d[j]);
    }
  }
  const config = {
    data: {
      labels: date,
      datasets,
      /*
      : [
        { type: "line", data: data1, borderColor: 'rgb(255, 99, 132)', fill: false, lineTension: 0, yAxisID: "yl" },
        { type: "bar", data: data2, backgroundColor: 'rgb(99, 255, 132)', fill: false, lineTension: 0, yAxisID: "yr" }
      ]
      */
    },
    options: {
      //title: { display: true, text: "日本のインフルエンザ報告" },
      scales: {
        xAxes: [{ scaleLabel: { display: true, labelString: "週" } }],
        yAxes: [
          { id: "yr", position: "right", scaleLabel: { display: true, labelString: "報告数" }, ticks: { beginAtZero: true } },
          //{ id: "yl", position: "left", scaleLabel: { display: true, labelString: "PCR 検査陽性者数" }, ticks: { beginAtZero: true } },
        ],
      },
      legend: { display: false }
    }
  };
  new Chart.Chart(chart, config);
};
</script>
